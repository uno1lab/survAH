<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="survAH">
<title>Vignette for survAH package • survAH</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vignette for survAH package">
<meta property="og:description" content="survAH">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-inverse navbar-expand-lg bg-light" data-bs-theme="inverse"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">survAH</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette-survAH.html">Vignette for survAH package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/uno1lab/survAH">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Vignette for survAH package</h1>
                        <h4 data-toc-skip class="author">Hajime Uno<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Dana-Farber Cancer Institute, &lt;a href="mailto:huno@ds.dfci.harvard.edu" class="email"&gt;huno@ds.dfci.harvard.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>, Miki
Horiguchi<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Dana-Farber Cancer Institute, &lt;a href="mailto:horiguchimiki@gmail.com" class="email"&gt;horiguchimiki@gmail.com&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>, Zihan Qian<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Massachusetts General Hospital, &lt;a href="mailto:zihanqian16@gmail.com" class="email"&gt;zihanqian16@gmail.com&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">June 15, 2025</h4>
      
      
      <div class="d-none name"><code>vignette-survAH.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1 Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>An important objective of clinical research investigating the safety
and efficacy of a new intervention is to provide quantitative
information about the intervention effect on clinical outcomes. Such
quantitative information is critical for informed treatment decision
making to balance the risks and benefits of the new intervention. In
those studies where time-to-event outcomes are clinical endpoints of
interest, the traditional Cox’s hazard ratio (HR) has been used for
estimating and reporting the treatment effect magnitude for many
decades. However, this traditional approach may not have provided the
sufficient quantitative information that is needed for informed decision
making in clinical practice for the following reasons. First, this
approach does not require calculating the absolute hazard in each group
in order to calculate the HR, which is a desirable feature from a
statistical point of view, but which makes the clinical interpretation
difficult. From the clinical point of view, the two numbers from the
treatment and control groups are necessary for interpreting a
between-group contrast measure (e.g., difference or ratio). Second, if
the proportional hazards assumption is not correct, the interpretation
of HR is not obvious because it is affected by the underlying
study-specific censoring time distribution.[1,2]</p>
<p>The average hazard with survival weight (AHSW), which can be
interpreted as the general censoring-free incidence rate (CFIR), is a
summary measure of the event time distribution and does not depend on
the underlying study-specific censoring time distribution. The approach
using AHSW (or CFIR) provides two numbers from the treatment and control
groups and allows us to summarize the treatment effect magnitude in both
absolute and relative terms, which would enhance the clinical
interpretation of the treatment effect on time-to-event
outcomes.[3,4]</p>
<p>This vignette is a supplemental documentation for the <em>survAH</em>
package and illustrates how to use the functions in the package to
compare two groups with respect to the AHSW (or CFIR). The package was
made and tested on R version 4.4.1.</p>
</div>
<div class="section level2">
<h2 id="installation">2 Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Open the R or RStudio applications. Then, copy and paste either of
the following scripts to the command line.</p>
<p>To install the package from the CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"survAH"</span><span class="op">)</span></span></code></pre></div>
<p>To install the development version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span> <span class="co">#-- if the devtools package has not been installed</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"uno1lab/survAH"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sample-reconstructed-data">2 Sample Reconstructed Data<a class="anchor" aria-label="anchor" href="#sample-reconstructed-data"></a>
</h2>
<p>Throughout this vignette, we use sample reconstructed data of the
CheckMate214 study reported by Motzer et al. [5] The data consists of
847 patients with previously untreated clear-cell advanced renal-cell
carcinoma; 425 for the nivolumab plus ipilimumab group (treatment) and
422 for the sunitinib group (control).</p>
<p>The sample reconstructed data of the CheckMate214 study is available
on <em>survAH</em> package as <em>cm214_pfs</em>. To load the data, copy
and paste the following scripts to the command line.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">survAH</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cm214_pfs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 847</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cm214_pfs</span><span class="op">)</span></span>
<span><span class="co">#&gt;    time status arm</span></span>
<span><span class="co">#&gt; 1 0.451      1   1</span></span>
<span><span class="co">#&gt; 2 0.451      1   1</span></span>
<span><span class="co">#&gt; 3 0.451      1   1</span></span>
<span><span class="co">#&gt; 4 0.451      1   1</span></span>
<span><span class="co">#&gt; 5 0.451      1   1</span></span>
<span><span class="co">#&gt; 6 0.710      1   1</span></span></code></pre></div>
<p>Here, <strong>time</strong> is months from the registration to
progression-free survival (PFS), <strong>status</strong> is the
indicator of the event (1: event, 0: censor), and <strong>arm</strong>
is the treatment assignment indicator (1: Treatment group, 0: Control
group).</p>
<p>Below are the Kaplan-Meier estimates for the PFS for each treatment
group.</p>
<p><img src="vignette-survAH_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>The two survival curves showed similar trajectories up to six months,
but after that, a difference appeared between the two groups. This is
the so-called delayed difference pattern often seen in immunotherapy
trials. The HR based on the traditional Cox’s method was 0.82 (0.95CI:
0.68 to 0.99, p-value=0.037). Since the validity of the proportional
hazards assumption was not clear in this study, there is no clear
interpretation on the reported HR. Even if the proportional hazards
assumption seemed to be reasonable, the lack of a group-specific
absolute value regarding hazard makes the clinical interpretation of the
treatment effect difficult. For example, if the baseline absolute hazard
is very low, the reported HR (0.82) may indicate a clinically ignorable
treatment effect magnitude. If it is high, even an HR that is closer to
1 (e.g., 0.98) may indicate a clinically significant treatment effect
magnitude.</p>
</div>
<div class="section level2">
<h2 id="average-hazard-with-survival-weight-ahsw">3 Average Hazard with Survival Weight (AHSW)<a class="anchor" aria-label="anchor" href="#average-hazard-with-survival-weight-ahsw"></a>
</h2>
<p>For a given <span class="math inline">\(\tau,\)</span> a general form
of the average hazard (AH) is denoted by <span class="math display">\[
\eta(t) = \frac{\int_0^\tau h(u)w(u)du}{\int_0^\tau w(u)du},\]</span>
where <span class="math inline">\(h(t)\)</span> and <span class="math inline">\(w(t)\)</span> are the hazard function for the
event time <span class="math inline">\(T,\)</span> and a non-negative
weight function, respectively. Let <span class="math inline">\(S(t)\)</span> be the survival function for <span class="math inline">\(T.\)</span> We use <span class="math inline">\(S(t)\)</span> as the weight, which gives the AHSW
<span class="math display">\[ \eta(t) = \frac{\int_0^\tau
h(u)S(u)du}{\int_0^\tau S(u)du}.\]</span> The detailed motivation for
using <span class="math inline">\(S(t)\)</span> as <span class="math inline">\(w(t)\)</span> was discussed in Uno and Horiguchi
[3]. The AHSW has a clear interpretation as the average person-time
incidence rate on a given time window <span class="math inline">\([0,\tau].\)</span> It can also be called as the
general censoring-free incidence rate (CFIR) in contrast to the
conventional person-time incidence rate that potentially depends on an
underlying study-specific censoring time distribution.</p>
<p>From now on, we simply call the AHSW (or CFIR) the average hazard
(AH). The AH is denoted by the ratio of cumulative incidence probability
and restricted mean survival time at <span class="math inline">\(\tau
&lt; \infty\)</span>: <span class="math display">\[ \eta(\tau) =
\frac{1-S(\tau)}{\int_0^\tau S(t)dt}.\]</span></p>
<p>Let <span class="math inline">\(\widehat{S}(t)\)</span> denote the
Kaplan-Meier estimator for <span class="math inline">\(S(t).\)</span> A
natural estimator for <span class="math inline">\(\eta(\tau)\)</span> is
then given by<br><span class="math display">\[ \widehat{\eta}(\tau) =
\frac{1-\widehat{S}(\tau)}{\int_0^\tau {\widehat S} (t)dt}.\]</span> The
large sample properties and a standard error formula of <span class="math inline">\(\widehat{\eta}(\tau)\)</span> are given in Uno and
Horiguchi [3].</p>
</div>
<div class="section level2">
<h2 id="two-sample-comparison-using-ah-and-its-implementation">4 Two-sample comparison using AH and its implementation<a class="anchor" aria-label="anchor" href="#two-sample-comparison-using-ah-and-its-implementation"></a>
</h2>
<p>Let <span class="math inline">\(\eta_{1}(\tau)\)</span> and <span class="math inline">\(\eta_{0}(\tau)\)</span> denote the AH for
treatment group 1 and 0, respectively. Now, we compare the two survival
curves, using the AH. Specifically, we consider the following two
measures to capture the between-group contrast:</p>
<ol style="list-style-type: decimal">
<li>Difference in AH (DAH) <span class="math display">\[ \eta_{1}(\tau)
- \eta_{0}(\tau) \]</span>
</li>
<li>Ratio of AH (RAH) <span class="math display">\[ \eta_{1}(\tau) /
\eta_{0}(\tau) \]</span>
</li>
</ol>
<p>These are estimated by simply replacing <span class="math inline">\(\eta_{1}(\tau)\)</span> and <span class="math inline">\(\eta_{0}(\tau)\)</span> by their empirical
counterparts (i.e., <span class="math inline">\(\widehat{\eta_{1}}(\tau)\)</span> and <span class="math inline">\(\widehat{\eta_{0}}(\tau)\)</span>, respectively).
For the inference of the ratio type metrics, we use the delta method to
calculate the standard error. Specifically, we consider <span class="math inline">\(\log \{ \widehat{\eta_{1}}(\tau)\}\)</span> and
<span class="math inline">\(\log \{ \widehat{\eta_{0}}(\tau)\}\)</span>
and calculate the standard error of log-AH. We then calculate a
confidence interval for the log-ratio of AH, and transform it back to
the original ratio scale; the detailed formula is given in [4].</p>
<p>The procedures below show how to use the function,
<strong>ah2</strong>, to implement these analyses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time</span>   <span class="op">=</span> <span class="va">cm214_pfs</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">status</span> <span class="op">=</span> <span class="va">cm214_pfs</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="va">arm</span>    <span class="op">=</span> <span class="va">cm214_pfs</span><span class="op">$</span><span class="va">arm</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ah2.html">ah2</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">time</span>, status<span class="op">=</span><span class="va">status</span>, arm<span class="op">=</span><span class="va">arm</span>, tau<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span></code></pre></div>
<p>The first argument (<strong>time</strong>) is the time-to-event
vector variable. The second argument (<strong>status</strong>) is also a
vector variable with the same length as <strong>time</strong>, each of
the elements takes either 1 (if event) or 0 (if no event). The third
argument (<strong>arm</strong>) is a vector variable to indicate the
assigned treatment of each subject; the elements of this vector take
either 1 (if the active treatment arm) or 0 (if the control arm). The
fourth argument (<strong>tau</strong>) is a scalar value to specify the
truncation time point <span class="math inline">\({\tau}\)</span> for
the AH calculation.</p>
<p>When <span class="math inline">\(\tau\)</span> is not specified in
<strong>ah2</strong>, (i.e., when the code looks like below)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ah2.html">ah2</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span>, <span class="va">arm</span><span class="op">)</span></span></code></pre></div>
<p>the default <span class="math inline">\(\tau\)</span> (i.e., the
maximum time point where the size of risk set for both groups remains at
least 10) is used to calculate the AH. It is best to confirm that the
size of the risk set is large enough at the specified <span class="math inline">\(\tau\)</span> in each group to make sure the
Kaplan-Meier estimates are stable.</p>
<p>The <strong>ah2</strong> function returns AH on each group and the
results of the between-group contrast measures listed above. Note that
we chose 21 months for <span class="math inline">\(\tau\)</span> in this
example.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/ah2.html">ah2</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span>, <span class="va">arm</span>, tau<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obj</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The time window: [eta, tau] = [0, 21] was specified.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of observations: </span></span>
<span><span class="co">#&gt;      Total N Event by tau Censor by tau At risk at tau</span></span>
<span><span class="co">#&gt; arm0     422          225           163             34</span></span>
<span><span class="co">#&gt; arm1     425          219           160             46</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Hazard (AH) by arm: </span></span>
<span><span class="co">#&gt;            Est. Lower 0.95 Upper 0.95</span></span>
<span><span class="co">#&gt; AH (arm0) 0.066      0.057      0.076</span></span>
<span><span class="co">#&gt; AH (arm1) 0.049      0.042      0.057</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Between-group contrast: </span></span>
<span><span class="co">#&gt;                                Est. Lower 0.95 Upper 0.95 P-value</span></span>
<span><span class="co">#&gt; Ratio of AH (arm1/arm0)       0.747      0.608      0.917   0.005</span></span>
<span><span class="co">#&gt; Difference of AH (arm1-arm0) -0.017     -0.029     -0.005   0.006</span></span></code></pre></div>
<p>The estimated AHs were 0.049 (0.95CI: 0.042 to 0.057) and 0.066
(0.95CI: 0.057 to 0.076) for the treatment group and the control group,
respectively. The ratio and difference of AH were 0.747 (0.95CI: 0.608
to 0.917, p-value=0.005) and -0.017 (0.95CI: -0.029 to -0.005,
p-value=0.006), respectively.</p>
</div>
<div class="section level2">
<h2 id="stratified-analysis-using-the-ah-and-its-implementation">5 Stratified analysis using the AH and its implementation<a class="anchor" aria-label="anchor" href="#stratified-analysis-using-the-ah-and-its-implementation"></a>
</h2>
<p>Stratified analysis is commonly used in clinical trials to adjust for
imbalanced baseline characteristics or known prognostic factors.
However, traditional stratified methods (e.g., Stratified Cox or CMH)
assume homogeneous effects across strata, which may not hold in
practice. To overcome this, we extend the AH framework to stratified
settings using standardization[4]. This approach adjusts for
stratification while preserving the interpretability of both absolute
and relative treatment effects.</p>
<p>In this framework, treatment effects are summarized using the
adjusted average hazard (AH), which is defined based on standardized
survival curves across strata:</p>
<p><span class="math display">\[
\bar{S}_j(t) = \sum_{k=1}^{K} w_k S_{jk}(t),
\]</span></p>
<p>where <span class="math inline">\(S_{jk}(t)\)</span> denotes survival
function for group <span class="math inline">\(j\)</span> in stratum
<span class="math inline">\(k\)</span>, and <span class="math inline">\(w_k\)</span> is aset of weights that satisfies
<span class="math inline">\(\sum_{k=1}^{K} w_k = 1\)</span> for <span class="math inline">\(K\)</span> strata. In this version of the package,
<span class="math inline">\(w_k\)</span> is set to be the proportion of
subjects in stratum <span class="math inline">\(k,\)</span> i.e., <span class="math inline">\(w_k = (n_{0k}+n_{1k}) / (n_0 + n_1)\)</span>,
where <span class="math inline">\(n_{jk}\)</span> is the number of
subjects in stratum <span class="math inline">\(k\)</span> in the group
<span class="math inline">\(j\)</span> and <span class="math inline">\(n_j\)</span> is the total number of subjects in
the group <span class="math inline">\(j.\)</span></p>
<p>Using this, the adjusted AH for group <span class="math inline">\(j\)</span> is defined as</p>
<p><span class="math display">\[
\bar{\eta}_j(\tau) = \frac{1 -
\bar{S}_j(\tau)}{\int_{0}^{\tau}\bar{S}_j(t)du}
= \frac{1 - \left\{\sum_{k=1}^{K} w_k S_{jk}(\tau)\right\}}{\int_0^\tau
\left\{\sum_{k=1}^{K} w_k S_{jk}(u)\right\}du}.
\]</span> We estimate <span class="math inline">\(\bar{\eta}_j(\tau)\)</span> by replacing survival
functions with Kaplan–Meier estimators <span class="math inline">\(\widehat{S}_{jk}(t).\)</span></p>
<p><span class="math display">\[
\widehat{\bar{\eta}}_j(\tau)
= \frac{1 - \left\{\sum_{k=1}^{K} w_k
\widehat{S}_{jk}(\tau)\right\}}{\int_0^\tau \left\{\sum_{k=1}^{K} w_k
\widehat{S}_{jk}(u)\right\}du}.
\]</span></p>
<p>To compare two groups, we use the following contrast measures:
<strong>Difference in AH (DAH)</strong> is defined as <span class="math display">\[
\text{DAH}(\tau) = \bar{\eta}_1(\tau) - \bar{\eta}_0(\tau),
\]</span></p>
<p>and <strong>Ratio of AH (RAH)</strong> is defined as <span class="math display">\[
\text{RAH}(\tau) = \frac{\bar{\eta}_1(\tau)}{\bar{\eta}_0(\tau)}.
\]</span></p>
<p>Their estimators are <span class="math display">\[
\widehat{\text{DAH}}(\tau) = \widehat{\bar{\eta}}_1(\tau) -
\widehat{\bar{\eta}}_0(\tau), \quad
\widehat{\text{RAH}}(\tau) =
\frac{\widehat{\bar{\eta}}_1(\tau)}{\widehat{\bar{\eta}}_0(\tau)}.
\]</span></p>
<p>We also illustrate how to perform stratified analysis using the AH
with the <em>myeloid</em> dataset from the <em>survival</em> package.
This dataset simulates a randomized trial in acute myeloid leukemia and
includes a stratification factor based on mutations of the FLT3 gene
(levels A, B, C), which is known to affect prognosis.[6]</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">myeloid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 646</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">myeloid</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id trt sex flt3 futime death txtime crtime rltime</span></span>
<span><span class="co">#&gt; 1  1   B   f    C    235     1     NA     44    113</span></span>
<span><span class="co">#&gt; 2  2   A   m    B    286     1    200     NA     NA</span></span>
<span><span class="co">#&gt; 3  3   A   f    A   1983     0     NA     38     NA</span></span>
<span><span class="co">#&gt; 4  4   B   f    A   2137     0    245     25     NA</span></span>
<span><span class="co">#&gt; 5  5   B   f    C    326     1    112     56    200</span></span>
<span><span class="co">#&gt; 6  6   B   f    C   2041     0    102     NA     NA</span></span>
<span></span>
<span><span class="co"># Create new analysis variables:</span></span>
<span><span class="co"># - arm_num: binary treatment indicator (1 = arm B [treatment], 0 = arm A [control])</span></span>
<span><span class="co"># - time_yr: follow-up time converted from days to years</span></span>
<span><span class="va">myeloid</span><span class="op">$</span><span class="va">arm_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">myeloid</span><span class="op">$</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">myeloid</span><span class="op">$</span><span class="va">time_yr</span> <span class="op">&lt;-</span> <span class="va">myeloid</span><span class="op">$</span><span class="va">futime</span> <span class="op">/</span> <span class="fl">365.25</span></span></code></pre></div>
<p>This data frame contains 646 observations and 9 variables. For the
current analysis, we focus on the following key variables:
<strong>futime</strong>, which represents the time to death or last
follow-up; <strong>death</strong>, a censoring indicator where 1 denotes
death and 0 indicates censoring; <strong>trt</strong>, the treatment
variable with two levels, arm A and arm B; and <strong>flt3</strong>,
which represents the mutation burden of the FLT3 gene, categorized as
levels A, B, and C, and be used as a stratification factor in our
following analysis.</p>
<p>Below are Kaplan-Meier plots of survival stratified by FLT3 mutation
levels (A, B, C). These curves suggest potential heterogeneity in
treatment effects across strata.</p>
<p><img src="vignette-survAH_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p><img src="vignette-survAH_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p><img src="vignette-survAH_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>We now apply the <code><a href="../reference/ah2.html">ah2()</a></code> function from the
<code>survAH</code> package to conduct a stratified AH analysis with
FLT3 mutation levels as the stratification factor.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myel_time</span>   <span class="op">=</span> <span class="va">myeloid</span><span class="op">$</span><span class="va">time_yr</span></span>
<span><span class="va">myel_status</span> <span class="op">=</span> <span class="va">myeloid</span><span class="op">$</span><span class="va">death</span></span>
<span><span class="va">myel_arm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">myeloid</span><span class="op">$</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># Convert treatment variable to binary: 1 = treatment (arm B), 0 = control (arm A)</span></span>
<span><span class="va">myel_strata</span> <span class="op">=</span> <span class="va">myeloid</span><span class="op">$</span><span class="va">flt3</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ah2.html">ah2</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">myel_time</span>,</span>
<span>    status <span class="op">=</span> <span class="va">myel_status</span>,</span>
<span>    arm <span class="op">=</span> <span class="va">myel_arm</span>,</span>
<span>    tau <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    strata <span class="op">=</span> <span class="va">myel_strata</span><span class="op">)</span></span></code></pre></div>
<p>We set <span class="math inline">\(\tau\)</span> to 3 (years).
Compared to the previous sections, the other arguments remain the same,
but we now introduce a new argument <strong>strata</strong> to perform a
stratified analysis. The <strong>strata</strong> argument allows us to
specify a categorical variable that defines the strata for the analysis.
In this case, we use the FLT3 mutation levels as the stratification
factor. The function will then report results from both
<em>unstratified</em> and <em>stratified</em> analyses.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">myel_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ah2.html">ah2</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">myel_time</span>,</span>
<span>                status <span class="op">=</span> <span class="va">myel_status</span>,</span>
<span>                arm <span class="op">=</span> <span class="va">myel_arm</span>,</span>
<span>                tau <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                strata <span class="op">=</span> <span class="va">myel_strata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">myel_obj</span>,digit <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The time window: [eta, tau] = [0, 3] was specified.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of observations: </span></span>
<span><span class="co">#&gt;         total arm0 arm1</span></span>
<span><span class="co">#&gt; strata1   149   74   75</span></span>
<span><span class="co">#&gt; strata2   319  154  165</span></span>
<span><span class="co">#&gt; strata3   178   89   89</span></span>
<span><span class="co">#&gt; total     646  317  329</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Total N Event by tau Censor by tau At risk at tau</span></span>
<span><span class="co">#&gt; arm0     317          160            28            129</span></span>
<span><span class="co">#&gt; arm1     329          142            18            169</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;Unstratified analysis&gt; Average Hazard (AH) by arm: </span></span>
<span><span class="co">#&gt;            Est. Lower 0.95 Upper 0.95</span></span>
<span><span class="co">#&gt; AH (arm0) 0.290      0.245      0.343</span></span>
<span><span class="co">#&gt; AH (arm1) 0.207      0.175      0.246</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;Unstratified analysis&gt; Between-group contrast: </span></span>
<span><span class="co">#&gt;                                Est. Lower 0.95 Upper 0.95 P-value</span></span>
<span><span class="co">#&gt; Ratio of AH (arm1/arm0)       0.715      0.563      0.910   0.006</span></span>
<span><span class="co">#&gt; Difference of AH (arm1-arm0) -0.082     -0.143     -0.022   0.007</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;Stratified analysis&gt; Average Hazard (AH) by arm: </span></span>
<span><span class="co">#&gt;            Est. Lower 0.95 (orginal scale) Upper 0.95 (orginal scale)</span></span>
<span><span class="co">#&gt; AH (arm0) 0.286                      0.235                      0.337</span></span>
<span><span class="co">#&gt; AH (arm1) 0.207                      0.170                      0.243</span></span>
<span><span class="co">#&gt;           Lower 0.95 (based on log scale) Upper 0.95 (based on log scale)</span></span>
<span><span class="co">#&gt; AH (arm0)                           0.239                           0.342</span></span>
<span><span class="co">#&gt; AH (arm1)                           0.173                           0.247</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;Stratified analysis&gt; Between-group contrast: </span></span>
<span><span class="co">#&gt;                                Est. Lower 0.95 Upper 0.95 P-value</span></span>
<span><span class="co">#&gt; Ratio of AH (arm1/arm0)       0.723      0.562      0.930   0.011</span></span>
<span><span class="co">#&gt; Difference of AH (arm1-arm0) -0.079     -0.142     -0.016   0.013</span></span></code></pre></div>
<p>As shown in the <strong>ah2</strong> results above, in the
unstratified analysis, the estimated AHs were 0.290 (95% CI: 0.245 to
0.343) for the control group and 0.207 (95% CI: 0.175 to 0.246) for the
treatment group. The estimated RAH was 0.715 (95% CI: 0.563 to 0.910, p
= 0.006), and the DAH was -0.082 (95% CI: -0.143 to -0.022, p = 0.007).
In the stratified analysis, which adjusts for FLT3 mutation subgroups,
the AHs were 0.286 (95% CI: 0.235 to 0.337) for the control group and
0.207 (95% CI: 0.170 to 0.243) for the treatment group. The RAH was
0.723 (95% CI: 0.562 to 0.930, p = 0.011), and the DAH was -0.079 (95%
CI: -0.142 to -0.016, p = 0.013).</p>
</div>
<div class="section level2">
<h2 id="conclusions">6 Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>As illustrated, the presented approach using AHSW provides more
robust and reliable quantitative information about the treatment effect
on time-to-event outcomes than the traditional Cox’s hazard ratio
approach. We hope the AHSW-based approach, along with this
<em>survAH</em> package, will be helpful to clinical researchers by
providing interpretable quantitative information about the treatment
effect magnitude, which will ultimately foster better informed decision
making.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] Uno H, Claggett B, Tian L, et al. Moving beyond the hazard ratio
in quantifying the between-group difference in survival analysis. J Clin
Oncol. 2014 Aug 1;32(22):2380-5. doi: 10.1200/JCO.2014.55.2208. Epub
2014 Jun 30. PMID: 24982461; PMCID: PMC4105489.</p>
<p>[2] Horiguchi M, Hassett MJ, Uno H. How Do the Accrual Pattern and
Follow-Up Duration Affect the Hazard Ratio Estimate When the
Proportional Hazards Assumption Is Violated? Oncologist. 2019
Jul;24(7):867-871. doi: 10.1634/theoncologist.2018-0141. Epub 2018 Sep
10. PMID: 30201741; PMCID: PMC6656438.</p>
<p>[3] Uno H, Horiguchi M. Ratio and difference of average hazard with
survival weight: New measures to quantify survival benefit of new
therapy. Stat Med. 2023 Mar 30;42(7):936-952. doi: 10.1002/sim.9651.
Epub 2023 Jan 5. PMID: 36604833.</p>
<p>[4] Qian Z, Tian L, Horiguchi M, Uno H. A Novel Stratified Analysis
Method for Testing and Estimating Overall Treatment Effects on
Time-To-Event Outcomes Using Average Hazard With Survival Weight. Stat
Med. 2025 Mar 30;44(7):e70056. doi: 10.1002/sim.70056. PMID:
40213923.</p>
<p>[5] Motzer RJ, Tannir NM, McDermott DF, et al. Nivolumab plus
Ipilimumab versus Sunitinib in Advanced Renal-Cell Carcinoma. N Engl J
Med. 2018 Apr 5;378(14):1277-1290. doi: 10.1056/NEJMoa1712126. Epub 2018
Mar 21. PMID: 29562145; PMCID: PMC5972549.</p>
<p>[6] Le-Rademacher JG, Peterson RA, Therneau TM, Sanford BL, Stone RM,
Mandrekar SJ. Application of multi-state models in cancer clinical
trials. Clin Trials. 2018 Oct;15(5):489-498. doi:
10.1177/1740774518789098. Epub 2018 Jul 23. PMID: 30035644; PMCID:
PMC6133743.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.uno1lab.com/" class="external-link">Hajime Uno</a>, Miki Horiguchi, Zihan Qian.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
